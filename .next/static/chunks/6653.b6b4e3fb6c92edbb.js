"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6653],{6653:function(t,e,i){i.r(e),i.d(e,{GoogleCastProvider:function(){return d}});var s=i(1001),a=i(2938),h=i(7797);i(2265);class r{build(){return this.ab}mj(t){return t.includes("live")?this.ab.streamType=chrome.cast.media.StreamType.LIVE:this.ab.streamType=chrome.cast.media.StreamType.BUFFERED,this}nj(t){return this.ab.tracks=t.map(this.oj),this}pj(t,e){return this.ab.metadata=new chrome.cast.media.GenericMediaMetadata,this.ab.metadata.title=t,this.ab.metadata.images=[{url:e}],this}oj(t,e){let i=new chrome.cast.media.Track(e,chrome.cast.media.TrackType.TEXT);return i.name=t.label,i.trackContentId=t.src,i.trackContentType="text/vtt",i.language=t.language,i.subtype=t.kind.toUpperCase(),i}constructor(t){this.ab=new chrome.cast.media.MediaInfo(t.src,t.type)}}let n=chrome.cast.media.TrackType.TEXT,l=chrome.cast.media.TrackType.AUDIO;class o{ie(){let t=this.vg.bind(this);(0,s.l)(this.b.audioTracks,"change",t),(0,s.l)(this.b.textTracks,"mode-change",t),(0,s.e)(this.qj.bind(this))}od(){return this.b.$state.textTracks().filter(t=>t.src&&"vtt"===t.type)}wg(){return this.b.$state.audioTracks()}yc(t){var e,i;let s=null!==(i=null===(e=this.pd.mediaInfo)||void 0===e?void 0:e.tracks)&&void 0!==i?i:[];return t?s.filter(e=>e.type===t):s}rj(){let t=[],e=this.wg().find(t=>t.selected),i=this.od().filter(t=>"showing"===t.mode);if(e){let i=this.yc(l),s=this.Ae(i,e);s&&t.push(s.trackId)}if(null==i?void 0:i.length){let e=this.yc(n);if(e.length)for(let s of i){let i=this.Ae(e,s);i&&t.push(i.trackId)}}return t}qj(){let t=this.od();if(!this.pd.isMediaLoaded)return;let e=this.yc(n);for(let i of t)if(!this.Ae(e,i)){(0,s.q)(()=>{var t;return null===(t=this.Be)||void 0===t?void 0:t.call(this)});break}}sj(t){if(!this.pd.isMediaLoaded)return;let e=this.wg(),i=this.od(),s=this.yc(l),h=this.yc(n);for(let i of s){var r;if(this.xg(e,i))continue;let s={id:i.trackId.toString(),label:i.name,language:i.language,kind:null!==(r=i.subtype)&&void 0!==r?r:"main",selected:!1};this.b.audioTracks[a.L.ea](s,t)}for(let e of h){if(this.xg(i,e))continue;let s={id:e.trackId.toString(),src:e.trackContentId,label:e.name,language:e.language,kind:e.subtype.toLowerCase()};this.b.textTracks.add(s,t)}}vg(t){if(!this.pd.isMediaLoaded)return;let e=this.rj(),i=new chrome.cast.media.EditTracksInfoRequest(e);this.tj(i).catch(t=>{})}tj(t){let e=(0,h.g)();return new Promise((i,s)=>null==e?void 0:e.editTracksInfo(t,i,s))}xg(t,e){return t.find(t=>this.yg(t,e))}Ae(t,e){return t.find(t=>this.yg(e,t))}yg(t,e){return e.name===t.label&&e.language===t.language&&e.subtype.toLowerCase()===t.kind.toLowerCase()}constructor(t,e,i){this.pd=t,this.b=e,this.Be=i}}class d{get c(){return this.b.delegate.c}get type(){return"google-cast"}get currentSrc(){return this.L}get player(){return this.f}get cast(){return(0,h.a)()}get session(){return(0,h.b)()}get media(){return(0,h.g)()}get hasActiveSession(){return(0,h.h)(this.L)}setup(){this.uj(),this.vj(),this.wa.ie(),this.c("provider-setup",this)}uj(){(0,h.l)(cast.framework.CastContextEventType.CAST_STATE_CHANGED,this.Ag.bind(this))}vj(){let t=cast.framework.RemotePlayerEventType,e={[t.IS_CONNECTED_CHANGED]:this.Ag,[t.IS_MEDIA_LOADED_CHANGED]:this.Bg,[t.CAN_CONTROL_VOLUME_CHANGED]:this.Cg,[t.CAN_SEEK_CHANGED]:this.Dg,[t.DURATION_CHANGED]:this.ee,[t.IS_MUTED_CHANGED]:this.Oa,[t.VOLUME_LEVEL_CHANGED]:this.Oa,[t.IS_PAUSED_CHANGED]:this.wj,[t.LIVE_SEEKABLE_RANGE_CHANGED]:this.ob,[t.PLAYER_STATE_CHANGED]:this.xj};this.zg=e;let i=this.yj.bind(this);for(let t of(0,s.r)(e))this.f.controller.addEventListener(t,i);(0,s.v)(()=>{for(let t of(0,s.r)(e))this.f.controller.removeEventListener(t,i)})}async play(){var t;if(this.f.isPaused||this.Ce){if(this.Ce){await this.Eg(!1,0);return}null===(t=this.f.controller)||void 0===t||t.playOrPause()}}async pause(){var t;this.f.isPaused||null===(t=this.f.controller)||void 0===t||t.playOrPause()}getMediaStatus(t){return new Promise((e,i)=>{var s;null===(s=this.media)||void 0===s||s.getStatus(t,e,i)})}setMuted(t){var e;(t&&!this.f.isMuted||!t&&this.f.isMuted)&&(null===(e=this.f.controller)||void 0===e||e.muteOrUnmute())}setCurrentTime(t){var e;this.f.currentTime=t,this.c("seeking",t),null===(e=this.f.controller)||void 0===e||e.seek()}setVolume(t){var e;this.f.volumeLevel=t,null===(e=this.f.controller)||void 0===e||e.setVolumeLevel()}async loadSource(t){var e;if((null===(e=this.Qa)||void 0===e?void 0:e.src)!==t&&(this.Qa=null),(0,h.h)(t)){this.zj(),this.L=t;return}this.c("load-start");let i=this.Aj(t),s=await this.session.loadMedia(i);if(s){this.L=null,this.c("error",Error((0,h.c)(s)));return}this.L=t}destroy(){this.A(),this.Fg()}A(){this.Qa||(this.ha=0,this.ca=new a.T(0,0),this.Ba=new a.T(0,0)),this.ga.aa(),this.va=0,this.Qa=null}zj(){var t;let e=new s.D("resume-session",{detail:this.session});this.Bg(e);let{muted:i,volume:a,savedState:h}=this.b.$state,r=h();this.setCurrentTime(Math.max(this.f.currentTime,null!==(t=null==r?void 0:r.currentTime)&&void 0!==t?t:0)),this.setMuted(i()),this.setVolume(a()),(null==r?void 0:r.paused)===!1&&this.play()}Fg(){this.cast.endCurrentSession(!0);let{remotePlaybackLoader:t}=this.b.$state;t.set(null)}Bj(){let{savedState:t}=this.b.$state;t.set({paused:this.f.isPaused,currentTime:this.f.currentTime}),this.Fg()}lc(){this.Cj()}yj(t){this.zg[t.type].call(this,t)}Ag(t){let e=this.cast.getCastState(),i=e===cast.framework.CastState.CONNECTED?"connected":e===cast.framework.CastState.CONNECTING?"connecting":"disconnected";if(this.Aa===i)return;let s=this.bb(t);this.Aa=i,this.c("remote-playback-change",{type:"google-cast",state:i},s),"disconnected"===i&&this.Bj()}Bg(t){if(!this.f.isMediaLoaded)return;let e=(0,s.p)(this.b.$state.source);Promise.resolve().then(()=>{if(e!==(0,s.p)(this.b.$state.source)||!this.f.isMediaLoaded)return;this.A();let i=this.f.duration;this.Ba=new a.T(0,i);let h={provider:this,duration:i,buffered:this.ca,seekable:this.Gg()},r=this.bb(t);this.c("loaded-metadata",void 0,r),this.c("loaded-data",void 0,r),this.c("can-play",h,r),this.Cg(),this.Dg(t);let{volume:n,muted:l}=this.b.$state;this.setVolume(n()),this.setMuted(l()),this.ga.Ya(),this.wa.sj(r),this.wa.vg(r)})}Cg(){this.b.$state.canSetVolume.set(this.f.canControlVolume)}Dg(t){let e=this.bb(t);this.c("stream-type-change",this.Dj(),e)}Dj(){var t;return(null===(t=this.f.mediaInfo)||void 0===t?void 0:t.streamType)===chrome.cast.media.StreamType.LIVE?this.f.canSeek?"live:dvr":"live":"on-demand"}Cj(){if(this.Qa)return;let t=this.f.currentTime;if(t===this.va)return;let e=this.ha,i=this.vc(t);this.c("time-update",{currentTime:t,played:i}),t>e&&this.ob(),this.b.$state.seeking()&&this.c("seeked",t),this.va=t}vc(t){return this.ha>=t?this.ca:this.ca=new a.T(0,this.ha=t)}ee(t){if(!this.f.isMediaLoaded||this.Qa)return;let e=this.f.duration,i=this.bb(t);this.Ba=new a.T(0,e),this.c("duration-change",e,i)}Oa(t){if(!this.f.isMediaLoaded)return;let e={muted:this.f.isMuted,volume:this.f.volumeLevel},i=this.bb(t);this.c("volume-change",e,i)}wj(t){let e=this.bb(t);this.f.isPaused?this.c("pause",void 0,e):this.c("play",void 0,e)}ob(t){let e={seekable:this.Gg(),buffered:this.ca},i=t?this.bb(t):void 0;this.c("progress",e,i)}xj(t){let e=this.f.playerState,i=chrome.cast.media.PlayerState;if(this.Ce=e===i.IDLE,e===i.PAUSED)return;let s=this.bb(t);switch(e){case i.PLAYING:this.c("playing",void 0,s);break;case i.BUFFERING:this.c("waiting",void 0,s);break;case i.IDLE:this.ga.aa(),this.c("pause"),this.c("end")}}Gg(){return this.f.liveSeekableRange?new a.T(this.f.liveSeekableRange.start,this.f.liveSeekableRange.end):this.Ba}bb(t){return t instanceof Event?t:new s.D(t.type,{detail:t})}Ej(t){let{streamType:e,title:i,poster:s}=this.b.$state;return new r(t).pj(i(),s()).mj(e()).nj(this.wa.od()).build()}Aj(t){var e,i,s,a,h;let r=this.Ej(t),n=new chrome.cast.media.LoadRequest(r),l=this.b.$state.savedState();return n.autoplay=(null!==(s=null===(e=this.Qa)||void 0===e?void 0:e.paused)&&void 0!==s?s:null==l?void 0:l.paused)===!1,n.currentTime=null!==(h=null!==(a=null===(i=this.Qa)||void 0===i?void 0:i.time)&&void 0!==a?a:null==l?void 0:l.currentTime)&&void 0!==h?h:0,n}async Eg(t,e){let i=(0,s.p)(this.b.$state.source);this.Qa={src:i,paused:t,time:e},await this.loadSource(i)}Be(){this.Eg(this.f.isPaused,this.f.currentTime).catch(t=>{})}constructor(t,e){this.f=t,this.b=e,this.$$PROVIDER_TYPE="GOOGLE_CAST",this.scope=(0,s.d)(),this.L=null,this.Aa="disconnected",this.va=0,this.ha=0,this.ca=new a.T(0,0),this.Ba=new a.T(0,0),this.ga=new a.R(this.lc.bind(this)),this.Qa=null,this.Ce=!1,this.wa=new o(this.f,this.b,this.Be.bind(this))}}}}]);